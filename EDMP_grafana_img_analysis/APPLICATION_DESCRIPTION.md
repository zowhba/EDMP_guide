# EDMP Grafana 이미지 분석 애플리케이션

## 개요

Grafana 대시보드를 자동으로 캡처하고 Azure OpenAI GPT-4 Vision을 활용하여 AI 기반 분석을 수행하는 모니터링 자동화 시스템

## Notice

### 설치 유의사항
- **Grafana Render 플러그인 필수**: Grafana 서버에 이미지 렌더링 플러그인이 설치되어 있어야 합니다
- **Azure OpenAI 계정 필수**: GPT-4 Vision 모델이 배포된 Azure OpenAI 리소스가 필요합니다
- **Python 3.8 이상**: 최신 Python 환경에서 최적으로 동작합니다
- **네트워크 접근성**: Grafana 서버와 Azure OpenAI 엔드포인트에 대한 네트워크 접근이 필요합니다

### 설치 소요일정
- **초기 설정**: 약 30분 (Azure OpenAI 설정 포함)
- **환경 구축**: 약 15분 (패키지 설치 및 환경변수 설정)
- **테스트 및 검증**: 약 15분

### 제약 사항
- **Grafana 서버 요구사항**: Render 플러그인이 설치되지 않은 Grafana에서는 대시보드 캡처 기능을 사용할 수 없습니다
- **API 권한**: Grafana API 토큰의 Viewer 권한 이상이 필요합니다
- **성능 제한**: 대용량 이미지 분석 시 처리 시간이 길어질 수 있습니다 (90초 타임아웃)
- **파일 크기**: 업로드 이미지 크기는 최대 10MB로 제한됩니다
- **비용**: Azure OpenAI API 요금이 사용량에 따라 부과됩니다

### 비용
- **Azure OpenAI**: GPT-4 Vision 사용량에 따른 과금 (토큰 기반)
- **인프라**: 로컬 실행 시 추가 비용 없음

### 기타 고려사항
- **Grafana 관리자 협조**: Render 플러그인 설치는 Grafana 관리자 권한이 필요하므로 사전 협의가 필요합니다
- **데이터 보안**: 민감정보가 포함된 대시보드 분석 시 데이터 보안에 주의하세요
- **로컬 저장**: 분석 결과는 SQLite 데이터베이스에 로컬 저장됩니다
- **프로세스 분리**: FastAPI 백엔드와 Streamlit UI를 별도 프로세스로 실행해야 합니다

## Feature

### 주요 특징

#### 1. 자동화된 Grafana 캡처
- Grafana Render API를 활용한 대시보드 자동 스크린샷 생성
- 사용자 정의 해상도 설정 (800x600 ~ 3840x2160)
- 시간 범위 설정 (프리셋 또는 사용자 정의)
- 특정 조직 ID 및 대시보드 UID 지원

#### 2. AI 기반 이미지 분석
- **Azure OpenAI GPT-4 Vision**: 고성능 이미지 인식 및 분석
- **프롬프트 템플릿 시스템**: 분석 목적별 최적화된 템플릿 제공
  - 종합 분석: 전반적인 시스템 상태 및 성능 분석
  - 트렌드 분석: 시간별 변화 패턴 및 이상 징후 탐지
- **Fallback 메커니즘**: 이미지 분석 실패 시 텍스트 기반 가이드 제공

#### 3. 이중 분석 방식
- **Grafana 직접 캡처**: API를 통한 실시간 대시보드 캡처 및 분석
- **이미지 업로드**: 기존 스크린샷 파일 업로드를 통한 분석 지원

#### 4. 분석 이력 관리
- SQLite 기반 분석 결과 영구 저장
- 분석 ID별 상세 조회 및 필터링
- 대시보드 UID, 날짜 범위별 검색 기능
- 이미지와 분석 결과 연동 보관

#### 5. 사용자 친화적 인터페이스
- **Streamlit 기반 웹 UI**: 직관적이고 반응형 사용자 인터페이스
- **실시간 진행 상황 표시**: 캡처 → 분석 → 저장 과정의 시각적 피드백
- **템플릿 선택기**: 드롭다운을 통한 간편한 프롬프트 선택
- **이미지 미리보기**: 캡처된 대시보드 및 업로드 이미지 즉시 확인

#### 6. RESTful API 지원
- **FastAPI 백엔드**: 확장 가능한 API 아키텍처
- **Swagger 문서**: `/docs` 엔드포인트를 통한 API 문서 자동 생성
- **외부 시스템 연동**: 다른 시스템에서 API 호출을 통한 분석 수행 가능

#### 7. 프롬프트 템플릿 커스터마이징
- **텍스트 파일 기반**: `prompts/` 폴더의 `.txt` 파일 직접 편집
- **동적 로딩**: 템플릿 추가/수정 후 재시작만으로 즉시 적용
- **다국어 지원**: 한국어 기반 분석 결과 제공

#### 8. 오류 처리 및 복구
- **자동 재시도**: 분석 실패 시 짧은 프롬프트로 1회 재시도
- **상세 로깅**: 콘솔 로그를 통한 디버깅 정보 제공
- **Graceful Degradation**: 서비스 장애 시에도 기본 가이드 제공

### 활용 사례
- **24/7 모니터링**: 주기적 대시보드 분석을 통한 자동 상태 점검
- **장애 분석**: 이상 상황 발생 시 즉시 AI 분석을 통한 원인 파악
- **성능 리포팅**: 정기적인 성능 트렌드 분석 및 리포트 생성
- **교육 및 훈련**: 신규 담당자의 대시보드 해석 능력 향상 지원
